{
  "hash": "38709dff568296fc06f6bcfdb9531232",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Geography of income change\"\neditor: visual\n---\n\n\n\n\nIncomes in a region change by people getting higher (or lower) incomes as well as people moving in and out of a region. We can observe the aggregate effects by looking at change in income statistics.\n\n## Question\n\n**Where and how did incomes change in the City of Vancouver?**\n\n## Data sources\n\nThe main data sources for fine-geography income data is the census, although custom tabulations of T1FF taxfiler data can offer insight of this on an annual basis at the census tract geography. For our question we are interested in broad temporal ranges, so the 5-year census data will work well.\n\nWe need to decide which income concept is best suited for our question, it is worthwhile to spend some time with the [Census Income Reference Guide](https://www12.statcan.gc.ca/census-recensement/2021/ref/98-500/004/98-500-x2021004-eng.cfm) to understand how the data was collected and what income concept to use. Prior to 2011 the income data was part of the long form census. In 2011 the mandatory long form was replaced with the voluntary NHS, given people the option to link directly to T1FF taxfiler data or to detail the income data manually. Starting 2016 income data was linked for all people to the T1FF taxfiler data.\n\nThe question what income concept to use, e.g. individual income, household income, family income, employment income, etc, depends on the particular question we are interested in. For now we will go with family income, trying to understand how the income situation of families varies across Vancouver and across time. Family income is less affected by demographic factors like the distribution of single vs multiple person households, but is still impacted by e.g. differences in shares of seniors vs young families vs families at the peak of their earnings.\n\n## Data acquisition\n\nWe again use the [CensusMapper API tool](https://censusmapper.ca/api) to locate the internal CensusMapper identifiers for Median Total Income of Economic Families for the years 2006 through 2021. For 2001 the standard census products reported income for census families instead of economic families, so they aren't directly comparable. As geographic breakdown we choose census tracts.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nregions <- list(CSD=\"5915022\")\nincome_vectors <- c(\"2021\"=\"v_CA21_965\",\n                    \"2016\"=\"v_CA16_2447\",\n                    \"2011\"=\"v_CA11N_2456\",\n                    \"2006\"=\"v_CA06_1741\")\n```\n:::\n\n\n\n\nTo facilitate the data import we write a wrapper function to acquire the census data for each of our four years. For a given census year we create the corresponding dataset identifier and select the appropriate income variable. To reduce clutter we select just the income variable and also keep the geographic identifier, and add the census year to the table.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nget_census_data <- function(year){\n  year <- as.character(year)\n  get_census(year,regions=regions,\n             vectors=c(\"ef_income\"=as.character(income_vectors[year])),\n             geo_format=\"sf\",level=\"CT\") |>\n    select(GeoUID,ef_income) |>\n    mutate(Year=year)\n}\n```\n:::\n\n\n\n\nImporting the data is easy now, we just call our function for each census year and collect it into a data frame.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(cancensus)\nincome_data <- seq(2006,2021,5) |>\n  map_df(get_census_data) \n```\n:::\n\n\n\n\nLet's take a quick look.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(income_data) +\n  geom_sf(aes(fill=ef_income)) +\n  scale_fill_viridis_c(option=\"inferno\", labels=scales::dollar) +\n  facet_wrap(~Year) +\n  coord_sf(datum=NA) +\n  labs(title=\"Median economic family income\",\n       fill=\"Current dollars\",\n       caption=\"StatCan Census 2006-2021\")\n```\n\n::: {.cell-output-display}\n![](geography_of_income_change_files/figure-epub/unnamed-chunk-4-1.png)\n:::\n:::\n\n\n\n\n## Data preparation\n\nLooking at the above graph we can see the geographic variation in each year, but it is difficult to discern geographic trends over time as incomes have gone up a lot during this timeframe. It makes sense to look at inflation-adjusted incomes instead. For this we use annual consumer price index data from [StatCan Table 18-10-0005](https://www150.statcan.gc.ca/t1/tbl1/en/cv.action?pid=1810000501). To simplify things we locate the specific vector **v41693271** for the all-time CPI.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(cansim)\ninflation <- get_cansim_vector(\"v41693271\") |>\n  mutate(Year=strftime(Date,\"%Y\")) |>\n  select(Year,CPI=val_norm) |>\n  filter(Year %in% names(income_vectors))\n\ninflation\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 4 × 2\n  Year    CPI\n  <chr> <dbl>\n1 2006   109.\n2 2011   120.\n3 2016   128.\n4 2021   142.\n```\n\n\n:::\n:::\n\n\n\n\n## Analysis and visualization\n\nWith this, we can adjust the census data by inflation. We choose to base everything on 2021 dollars.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninflation <- inflation |>\n  mutate(CPI=CPI/last(CPI,order_by = Year))\n```\n:::\n\n\n\n\nNow we just join the inflation data onto our income data by year, this adds the `CPI` column from the inflation data frame to our income with the CPI value corresponding to the value in the `Year` column in each of the two data frames. We then colour by inflation-adjusted income using the same code for graphing as above.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nincome_data |>\n  left_join(inflation,by=\"Year\") |>\n  ggplot() +\n  geom_sf(aes(fill=ef_income/CPI)) +\n  scale_fill_viridis_c(option=\"inferno\", labels=scales::dollar) +\n  facet_wrap(~Year) +\n  coord_sf(datum=NA) +\n  labs(title=\"Median economic family income\",\n       fill=\"Constant 2021\\ndollars\",\n       caption=\"StatCan Census 2006-2021\")\n```\n\n::: {.cell-output-display}\n![](geography_of_income_change_files/figure-epub/unnamed-chunk-7-1.png)\n:::\n:::\n\n\n\n\nThis shows more clearly how incomes have increased over time, but it would be nice to compute the change in income 2006 to 2021 for each individual census tract. But keen observers will notice that some census tracts have changed over the years, making it very difficult to compare data directly.\n\n## Data acquisition (part 2)\n\nFortunately the problem of making census data comparable across time has been solved with the t[ongfen package](https://mountainmath.github.io/tongfen/index.html). This allows us to create a semi-custom tabulation on the fly on a harmonized geography based on census tracts by aggregating census data appropriately. One problem is that medians can't be aggregated, so we need to either use average income instead or be content that medians can only be approximated. By default the **tongfen** package aggregates medians as if they were averages and emits a warning. This is the route we will take for this.\n\nTo start out, we need to create metadata for the **tongfen** procedure. This is automated for Canadian census data, leveraging the metadata built into CensusMapper.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tongfen)\nmeta <- meta_for_ca_census_vectors(income_vectors)\n\nmeta\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 8 × 10\n  variable  label dataset type  aggregation units rule  parent geo_dataset  year\n  <chr>     <chr> <chr>   <chr> <chr>       <chr> <chr> <chr>  <chr>       <int>\n1 v_CA21_9… 2021  CA21    Orig… Median of … Curr… Medi… v_CA2… CA21         2021\n2 v_CA16_2… 2016  CA16    Orig… Median of … Curr… Medi… v_CA1… CA16         2016\n3 v_CA11N_… 2011  CA11N   Orig… Median of … Curr… Medi… v_CA1… CA11         2011\n4 v_CA06_1… 2006  CA06    Orig… Median of … Curr… Medi… v_CA0… CA06         2006\n5 v_CA21_9… v_CA… CA21    Extra Additive    <NA>  Addi… <NA>   CA21         2021\n6 v_CA16_2… v_CA… CA16    Extra Additive    <NA>  Addi… <NA>   CA16         2016\n7 v_CA11N_… v_CA… CA11N   Extra Additive    <NA>  Addi… <NA>   CA11         2011\n8 v_CA06_1… v_CA… CA06    Extra Additive    <NA>  Addi… <NA>   CA06         2006\n```\n\n\n:::\n:::\n\n\n\n\nThe metadata contains our original income data, as well as extra variables needed to properly aggregate the data. Getting the income data on a common geography is easy now.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nunified_income_data <- get_tongfen_ca_census(regions,meta)\n```\n:::\n\n\n\n\n## Analysis and visualization\n\nIn line with what we did before we look at inflation-adjusted income change. To this end we extract the adjustment factor for the 2006-2021 timeframe.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninflation_2006_2021 <- inflation |>\n  filter(Year==\"2006\") |>\n  pull(CPI)\n```\n:::\n\n\n\n\nWith that we can simply plot the data, mapping the inflation-adjusted percent change 2006 to 2021.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nunified_income_data |>\n  ggplot() +\n  geom_sf(aes(fill=`2021`/`2006`*inflation_2006_2021-1)) +\n  scale_fill_viridis_c(option=\"cividis\", labels=scales::percent) +\n  coord_sf(datum=NA) +\n  labs(title=\"Change in economic family income\",\n       fill=\"Change 2006-2021\\n(inflation adjusted)\",\n       caption=\"StatCan Census 2006-2021\")\n```\n\n::: {.cell-output-display}\n![](geography_of_income_change_files/figure-epub/unnamed-chunk-11-1.png)\n:::\n:::\n\n\n\n\n## Interpretation\n\nIn summary we see that income of economic families changed fastest in the Downtown Eastside, Grandview-Woodlands and Strathcona neighbourhoods, effectively doubling. Incomes increased least on the West Side, where they were already quite high to start with, and increased by about 50% throughout much of the East Side.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {
      "knitr": [
        "{\"type\":\"list\",\"attributes\":{},\"value\":[]}"
      ]
    },
    "preserve": null,
    "postProcess": false
  }
}